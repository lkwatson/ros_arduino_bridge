<launch>

    <arg name="ticks_per_meter" value="10000" />
    <arg name="wheel_separation" value="0.2" />

    <arg name="urdf_file" default="$(find ros_arduino_python)/config/prsg2_description.urdf" />
    <param name="robot_description" textfile="$(arg urdf_file)" />

    <arg name="map_file" default="$(find ros_arduino_python)/config/map/map_10x10_res0.05.yaml"/>
    <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)">
        <rosparam>
frame_id: odom
        </rosparam>
    </node>

    <node name="move_base" pkg="move_base" type="move_base" output="screen">
        <param name="controller_frequency" value="3.0" />

        <rosparam file="$(find ros_arduino_python)/config/nav/common.yaml"
            ns="global_costmap" />
        <rosparam file="$(find ros_arduino_python)/config/nav/common.yaml"
            ns="local_costmap" />

        <rosparam file="$(find ros_arduino_python)/config/nav/odom_global_costmap.yaml" />
        <rosparam file="$(find ros_arduino_python)/config/nav/odom_local_costmap.yaml" />

        <rosparam file="$(find ros_arduino_python)/config/nav/base_local_planner.yaml" />
    </node>

    <!-- Publish the robot state -->
    <node name="robot_state_publisher" pkg="robot_state_publisher" type="state_publisher">
        <param name="publish_frequency" value="10.0"/>
    </node>

    <!-- Provide simulated control of the robot joint angles -->
    <node name="joint_state_publisher" pkg="joint_state_publisher" type="joint_state_publisher">
        <param name="use_gui" value="False" />
        <param name="rate" value="10.0"/>
    </node>

    <node name="controller" pkg="diff_drive" type="diff_drive_controller" output="screen">
      <rosparam subst_value="true">
ticks_per_meter: $(arg ticks_per_meter)
wheel_separation: $(arg wheel_separation)
max_motor_speed: 3000
timeout: 1.0
      </rosparam>
    </node>

    <node name="odom_publisher" pkg="diff_drive" type="diff_drive_odometry" output="screen">
      <rosparam subst_value="true">
ticks_per_meter: $(arg ticks_per_meter)
wheel_separation: $(arg wheel_separation)
      </rosparam>
    </node>

    <node name="robot" pkg="diff_drive" type="diff_drive_mock_robot" output="screen">
      <remap from="~lwheel_desired_rate" to="lwheel_desired_rate" />
      <remap from="~rwheel_desired_rate" to="rwheel_desired_rate" />
      <remap from="~lwheel_ticks" to="lwheel_ticks" />
      <remap from="~rwheel_ticks" to="rwheel_ticks" />
    </node>

</launch>
